<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux å†…æ ¸ä¸­çš„ SELinux æœºåˆ¶ | AllenY&#39;s blog</title>
<link rel="shortcut icon" href="https://alleny.xyz/favicon.ico?v=1747120786321">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://alleny.xyz/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Linux å†…æ ¸ä¸­çš„ SELinux æœºåˆ¶ | AllenY&#39;s blog - Atom Feed" href="https://alleny.xyz/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=G-HPLP8D1S43"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HPLP8D1S43');
</script>


    <meta name="description" content="å®‰å…¨å¢å¼ºå¼Linuxï¼ˆSELinuxï¼ŒSecurity-Enhanced Linuxï¼‰æ˜¯ä¸€ä¸ªLinuxå†…æ ¸çš„å®‰å…¨æ¨¡å—ï¼Œå…¶æä¾›äº†è®¿é—®æ§åˆ¶å®‰å…¨ç­–ç•¥æœºåˆ¶ï¼ŒåŒ…æ‹¬äº†å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMandatory Access Controlï¼ŒMACï¼‰ã€‚

èƒ½åŠ›
S..." />
    <meta name="keywords" content="Technical Sharing" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://alleny.xyz">
  <img class="avatar" src="https://alleny.xyz/images/avatar.png?v=1747120786321" alt="">
  </a>
  <h1 class="site-title">
    AllenY&#39;s blog
  </h1>
  <p class="site-description">
    ğŸ§‘ğŸ»â€ğŸ’»ğŸ®ğŸ¿ğŸ¹ğŸ—»
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          Home
        </a>
      
    
      
        <a href="/archives" class="menu">
          Archive
        </a>
      
    
      
        <a href="/tags" class="menu">
          Tags
        </a>
      
    
      
        <a href="/post/about" class="menu">
          About
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/Yuan-Allen" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
    
      
        <a href="https://weibo.com/u/6478080851" target="_blank">
          <i class="ri-weibo-line"></i>
        </a>
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Linux å†…æ ¸ä¸­çš„ SELinux æœºåˆ¶
            </h2>
            <div class="post-info">
              <span>
                2024-04-15
              </span>
              <span>
                27 min read
              </span>
              
                <a href="https://alleny.xyz/tag/WT-UATSMl/" class="post-tag">
                  # Technical Sharing
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://alleny.xyz/post-images/selinux.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>å®‰å…¨å¢å¼ºå¼Linuxï¼ˆSELinuxï¼ŒSecurity-Enhanced Linuxï¼‰æ˜¯ä¸€ä¸ªLinuxå†…æ ¸çš„å®‰å…¨æ¨¡å—ï¼Œå…¶æä¾›äº†è®¿é—®æ§åˆ¶å®‰å…¨ç­–ç•¥æœºåˆ¶ï¼ŒåŒ…æ‹¬äº†å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMandatory Access Controlï¼ŒMACï¼‰ã€‚</p>
<!-- more -->
<h2 id="èƒ½åŠ›">èƒ½åŠ›</h2>
<h3 id="selinux-æ˜¯ä»€ä¹ˆ">SELinux æ˜¯ä»€ä¹ˆ</h3>
<p>SELinux æ˜¯ä¸€ä¸ªçµæ´»çš„å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ç³»ç»Ÿï¼Œå†…ç½®äº Linux å†…æ ¸ä¸­ã€‚SELinux ä¸ºç®¡ç†å‘˜æä¾›äº†ä¸€ç§å…¨é¢çš„è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œä½¿å…¶èƒ½å¤Ÿæ¯”ç°æœ‰çš„ Linux è‡ªä¸»è®¿é—®æ§åˆ¶ï¼ˆDACï¼‰æ›´ç²¾ç»†åœ°ç®¡ç†æƒé™ï¼Œå¹¶å­˜åœ¨äºè®¸å¤šä¸»è¦çš„ Linux å‘è¡Œç‰ˆä¸­ã€‚</p>
<blockquote>
<p>å®ƒæœ€åˆæ˜¯ä½œä¸º Linux å†…æ ¸çš„ä¸€ç³»åˆ—è¡¥ä¸ï¼Œç”±ç¾å›½å›½å®¶å®‰å…¨å±€ï¼ˆNSAï¼‰åˆ©ç”¨ Linux å®‰å…¨æ¨¡å—ï¼ˆLSMï¼‰å¼€å‘è€Œæˆã€‚<br>
SELinux äº 2000 å¹´å‘å¸ƒåˆ°å¼€æºç¤¾åŒºï¼Œå¹¶äº 2003 å¹´é›†æˆåˆ°ä¸Šæ¸¸ Linux å†…æ ¸ä¸­ã€‚</p>
</blockquote>
<h4 id="dacdiscretionary-access-controlè‡ªä¸»è®¿é—®æ§åˆ¶">DACï¼ˆDiscretionary Access Controlï¼Œè‡ªä¸»è®¿é—®æ§åˆ¶ï¼‰</h4>
<p>å¯¹äº DAC è€Œè¨€ï¼Œæ–‡ä»¶å’Œè¿›ç¨‹éƒ½æœ‰ç›¸åº”çš„æ‰€æœ‰è€…ã€‚æ‚¨å¯ä»¥è®©ç”¨æˆ·æ‹¥æœ‰æŸä¸ªæ–‡ä»¶ï¼Œè®©ç¾¤ç»„æ‹¥æœ‰æŸä¸ªæ–‡ä»¶ï¼Œæˆ–è®©å…¶ä»–äººï¼ˆå¯ä»¥æ˜¯å…¶ä»–ä»»ä½•äººï¼‰æ‹¥æœ‰æŸä¸ªæ–‡ä»¶ã€‚ç”¨æˆ·å¯ä»¥æ›´æ”¹è‡ªå·±æ–‡ä»¶çš„æƒé™ã€‚åœ¨æ²¡æœ‰ä½¿ç”¨ SELinux çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå†³å®šä¸€ä¸ªèµ„æºæ˜¯å¦èƒ½è¢«è®¿é—®çš„å› ç´ æ˜¯ï¼šæŸä¸ªèµ„æºæ˜¯å¦æ‹¥æœ‰å¯¹åº”ç”¨æˆ·çš„æƒé™ï¼ˆè¯»ã€å†™ã€æ‰§è¡Œï¼‰ã€‚åªè¦è®¿é—®è¿™ä¸ªèµ„æºçš„è¿›ç¨‹ç¬¦åˆä»¥ä¸Šçš„æ¡ä»¶å°±å¯ä»¥è¢«è®¿é—®ã€‚</p>
<p>æ ¹ç”¨æˆ·å¯¹ DAC ç³»ç»Ÿæ‹¥æœ‰å®Œå…¨è®¿é—®æ§åˆ¶æƒã€‚å¦‚æœæ‹¥æœ‰æ ¹è®¿é—®æƒé™ï¼Œåˆ™å¯ä»¥è®¿é—®å…¶ä»–ä»»ä½•ç”¨æˆ·çš„æ–‡ä»¶ï¼Œæˆ–åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯æœ€è‡´å‘½çš„é—®é¢˜ã€‚</p>
<h4 id="macmandatory-access-controlå¼ºåˆ¶è®¿é—®æ§åˆ¶">MACï¼ˆMandatory Access Controlï¼Œå¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼‰</h4>
<p>ä¼ ç»Ÿä¸Šï¼Œ Linux å’Œ UNIX ç³»ç»Ÿéƒ½é‡‡ç”¨ DACï¼Œè€Œ <strong>SELinux æ˜¯ Linux é‡‡ç”¨ MAC ç³»ç»Ÿçš„ç¤ºä¾‹</strong>ã€‚</p>
<p>å¼ºåˆ¶è®¿é—®æ§åˆ¶æ¨¡å‹ (MAC, Mandatory Access Control), æ˜¯ä¸ºäº†å¼¥è¡¥ DAC æƒé™æ§åˆ¶è¿‡äºåˆ†æ•£çš„é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚åœ¨è®¡ç®—æœºå®‰å…¨é¢†åŸŸæŒ‡ä¸€ç§ç”±æ“ä½œç³»ç»Ÿçº¦æŸçš„è®¿é—®æ§åˆ¶ï¼Œç›®æ ‡æ˜¯é™åˆ¶ä¸»ä½“æˆ–å‘èµ·è€…è®¿é—®æˆ–å¯¹å¯¹è±¡æˆ–ç›®æ ‡æ‰§è¡ŒæŸç§æ“ä½œçš„èƒ½åŠ›ã€‚ä»»ä½•ä¸»ä½“å¯¹ä»»ä½•å¯¹è±¡çš„ä»»ä½•æ“ä½œéƒ½å°†æ ¹æ®ä¸€ç»„**æˆæƒè§„åˆ™ï¼ˆä¹Ÿç§°ç­–ç•¥ï¼‰**è¿›è¡Œæµ‹è¯•ï¼Œå†³å®šæ“ä½œæ˜¯å¦å…è®¸ã€‚</p>
<p>å³ä½¿æ˜¯ä»¥ root èº«ä»½è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼Œä¸€èˆ¬ä¹Ÿåªèƒ½è®¿é—®åˆ°å®ƒæ‰€éœ€è¦çš„èµ„æºã€‚å³ä½¿ç¨‹åºå‡ºäº†æ¼æ´ï¼Œå½±å“èŒƒå›´ä¹Ÿåªæœ‰åœ¨å…¶å…è®¸è®¿é—®çš„èµ„æºèŒƒå›´å†…ã€‚å®‰å…¨æ€§å¤§å¤§å¢åŠ ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://alleny.xyz/post-images/1713149204595.png" alt="" loading="lazy"></figure>
<p>MAC çš„ç›®çš„æ˜¯å¼¥è¡¥ DAC çš„ä¸è¶³ï¼Œè€Œä¸æ˜¯ç”¨ä¾†å–ä»£ DACã€‚</p>
<h3 id="ä½¿ç”¨-selinux-çš„å¥½å¤„">ä½¿ç”¨ SELinux çš„å¥½å¤„</h3>
<ul>
<li>æ‰€æœ‰è¿›ç¨‹å’Œæ–‡ä»¶éƒ½è¢«æ ‡è®°ã€‚SELinux ç­–ç•¥è§„åˆ™å®šä¹‰äº†è¿›ç¨‹å¦‚ä½•ä¸æ–‡ä»¶äº¤äº’ï¼Œä»¥åŠè¿›ç¨‹å¦‚ä½•ç›¸äº’äº¤äº’ã€‚åªæœ‰å­˜åœ¨æ˜ç¡®å…è®¸çš„ SELinux ç­–ç•¥è§„åˆ™æ—¶ï¼Œæ‰èƒ½å…è®¸è®¿é—®ã€‚</li>
<li>ç²¾ç»†è®¿é—®æ§åˆ¶ã€‚ä¼ ç»Ÿçš„ UNIX é€šè¿‡ç”¨æˆ·çš„æˆæƒã€åŸºäº Linux çš„ç”¨æˆ·å’Œç»„è¿›è¡Œæ§åˆ¶ã€‚è€Œ SELinux çš„è®¿é—®æ§åˆ¶åŸºäºæ‰€æœ‰å¯ç”¨ä¿¡æ¯ï¼Œå¦‚ SELinux ç”¨æˆ·ã€è§’è‰²ã€ç±»å‹ä»¥åŠå¯é€‰çš„å®‰å…¨çº§åˆ«ã€‚</li>
<li>SELinux ç­–ç•¥ç”±ç³»ç»Ÿç®¡ç†å‘˜è¿›è¡Œå®šä¹‰ï¼Œå¹¶åœ¨ç³»ç»ŸèŒƒå›´å†…å¼ºåˆ¶æ‰§è¡Œã€‚</li>
<li>æ”¹è¿›äº†æƒé™å‡çº§æ”»å‡»çš„ç¼“è§£æ–¹æ¡ˆã€‚è¿›ç¨‹åœ¨åŸŸä¸­è¿è¡Œï¼Œå› æ­¤æ˜¯ç›¸äº’åˆ†ç¦»çš„ã€‚SELinux ç­–ç•¥è§„åˆ™å®šä¹‰äº†å¦‚ä½•å¤„ç†è®¿é—®æ–‡ä»¶å’Œå…¶å®ƒè¿›ç¨‹ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹è¢«ç ´åï¼Œæ”»å‡»è€…åªèƒ½è®¿é—®è¯¥è¿›ç¨‹çš„æ­£å¸¸åŠŸèƒ½ï¼Œè€Œä¸”åªèƒ½è®¿é—®å·²è¢«é…ç½®ä¸ºå¯ä»¥è¢«è¯¥è¿›ç¨‹è®¿é—®çš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼šå¦‚æœ Apache HTTP æœåŠ¡å™¨è¢«ç ´åï¼Œæ”»å‡»è€…æ— æ³•ä½¿ç”¨è¯¥è¿›ç¨‹è¯»å–ç”¨æˆ·ä¸»ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œé™¤éæ·»åŠ æˆ–è€…é…ç½®äº†ç‰¹å®šçš„ SELinux ç­–ç•¥è§„åˆ™å…è®¸è¿™ç±»è®¿é—®ã€‚</li>
<li>SELinux å¯ä»¥ç”¨æ¥å¼ºåˆ¶å®æ–½æ•°æ®æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼ŒåŒæ—¶ä¿æŠ¤è¿›ç¨‹ä¸å—ä¸å¯ä¿¡è¾“å…¥çš„å½±å“ã€‚</li>
</ul>
<h2 id="æ¥å£å’Œä½¿ç”¨æ–¹æ³•">æ¥å£å’Œä½¿ç”¨æ–¹æ³•</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3>
<p>SELinux é€šè¿‡ MAC æ–¹å¼æ¥ç®¡æ§è¿›ç¨‹ï¼Œè¿›ç¨‹æ˜¯ä¸»ä½“ï¼Œè€Œç›®æ ‡åˆ™æ˜¯è¯¥è¿›ç¨‹æƒ³è¦è¯»å–çš„èµ„æºã€‚</p>
<ul>
<li>
<p><strong>ä¸»ä½“ Subject</strong>ï¼šå¯ä»¥çœ‹æˆå°±æ˜¯è¿›ç¨‹ã€‚</p>
</li>
<li>
<p><strong>ç›®æ ‡ Object</strong>ï¼šç›®æ ‡èµ„æºï¼Œè¢«ä¸»ä½“è®¿é—®çš„èµ„æºã€‚å¯ä»¥æ˜¯æ–‡ä»¶ã€ç›®å½•ã€ç«¯å£ç­‰ã€‚</p>
</li>
<li>
<p><strong>æ”¿ç­– Policy</strong>ï¼š<br>
ç³»ç»Ÿä¸­é€šå¸¸æœ‰å¤§é‡çš„æ–‡ä»¶å’Œè¿›ç¨‹ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´å’Œå¼€é”€ï¼Œé€šå¸¸æˆ‘ä»¬åªæ˜¯é€‰æ‹©æ€§åœ°å¯¹æŸäº›è¿›ç¨‹è¿›è¡Œç®¡åˆ¶ã€‚<br>
è€Œå“ªäº›è¿›ç¨‹éœ€è¦ç®¡åˆ¶ã€è¦æ€ä¹ˆç®¡åˆ¶æ˜¯ç”±æ”¿ç­–å†³å®šçš„ã€‚<br>
ä¸€å¥—æ”¿ç­–é‡Œé¢æœ‰å¤šä¸ªè§„åˆ™ã€‚éƒ¨åˆ†è§„åˆ™å¯ä»¥æŒ‰ç…§éœ€æ±‚å¯ç”¨æˆ–ç¦ç”¨ï¼ˆä»¥ä¸‹æŠŠè¯¥ç±»å‹çš„è§„åˆ™ç§°ä¸ºå¸ƒå°”å‹è§„åˆ™ï¼‰ã€‚<br>
åœ¨ CentOS 7 ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸‰å¥—æ”¿ç­–ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li><code>targeted</code>ï¼šå¯¹å¤§éƒ¨åˆ†ç½‘ç»œæœåŠ¡è¿›ç¨‹è¿›è¡Œç®¡åˆ¶ã€‚è¿™æ˜¯ç³»ç»Ÿ<strong>é»˜è®¤ä½¿ç”¨</strong>çš„æ”¿ç­–ï¼ˆä¸‹æ–‡å‡ä½¿ç”¨æ­¤æ”¿ç­–ï¼‰ã€‚</li>
<li><code>minimum</code>ï¼šä»¥ <code>targeted</code> ä¸ºåŸºç¡€ï¼Œä»…å¯¹é€‰å®šçš„ç½‘ç»œæœåŠ¡è¿›ç¨‹è¿›è¡Œç®¡åˆ¶ã€‚ä¸€èˆ¬ä¸ç”¨ã€‚</li>
<li><code>mls</code>ï¼šå¤šçº§å®‰å…¨ä¿æŠ¤ã€‚å¯¹æ‰€æœ‰çš„è¿›ç¨‹è¿›è¡Œç®¡åˆ¶ã€‚è¿™æ˜¯æœ€ä¸¥æ ¼çš„æ”¿ç­–ï¼Œé…ç½®éš¾åº¦éå¸¸å¤§ã€‚ä¸€èˆ¬ä¸ç”¨ï¼Œé™¤éå¯¹å®‰å…¨æ€§æœ‰æé«˜çš„è¦æ±‚ã€‚</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨ä¸Šä¸‹æ–‡ security contextï¼š</strong><br>
åªæœ‰ä¸¤è€…çš„å®‰å…¨ä¸Šä¸‹æ–‡å¯¹åº”ä¸Šäº†ï¼Œä¸»é¢˜æ‰èƒ½è®¿é—®ç›®æ ‡ã€‚å®ƒä»¬çš„å¯¹åº”å…³ç³»ç”±æ”¿ç­–ä¸­çš„è§„åˆ™å†³å®šã€‚</p>
</li>
</ul>
<h3 id="selinux-çŠ¶æ€å’Œæ¨¡å¼">SELinux çŠ¶æ€å’Œæ¨¡å¼</h3>
<p>SELinux å¯ä½¿ç”¨ä¸‰ç§æ¨¡å¼ä¹‹ä¸€è¿è¡Œï¼š enforcingï¼ˆå¼ºåˆ¶ï¼‰ã€permissiveï¼ˆå®½å®¹ï¼‰æˆ– disabledï¼ˆç¦ç”¨ï¼‰ã€‚</p>
<ul>
<li>Enforcing æ¨¡å¼æ˜¯é»˜è®¤æ“ä½œæ¨¡å¼ï¼Œåœ¨ enforcing æ¨¡å¼ä¸‹ SELinux å¯æ­£å¸¸è¿è¡Œï¼Œå¹¶åœ¨æ•´ä¸ªç³»ç»Ÿä¸­å¼ºåˆ¶å®æ–½è½½å…¥çš„å®‰å…¨ç­–ç•¥ã€‚</li>
<li>åœ¨ permissive æ¨¡å¼ä¸­ï¼Œç³»ç»Ÿä¼šè±¡ enforcing æ¨¡å¼ä¸€æ ·åŠ è½½å®‰å…¨ç­–ç•¥ï¼ŒåŒ…æ‹¬æ ‡è®°å¯¹è±¡å¹¶åœ¨æ—¥å¿—ä¸­è®°å½•è®¿é—®æ‹’ç»æ¡ç›®ï¼Œä½†å®ƒå¹¶ä¸ä¼šæ‹’ç»ä»»ä½•æ“ä½œã€‚ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒç³»ç»Ÿä¸­ä½¿ç”¨ permissive æ¨¡å¼ï¼Œä½† permissive æ¨¡å¼å¯¹ SELinux ç­–ç•¥å¼€å‘å’Œè°ƒè¯•å¾ˆæœ‰å¸®åŠ©ã€‚</li>
<li>å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ç¦ç”¨ï¼ˆdisabledï¼‰æ¨¡å¼ã€‚å®ƒä¸ä»…ä¼šä½¿ç³»ç»Ÿé¿å…å¼ºåˆ¶ä½¿ç”¨ SELinux ç­–ç•¥ï¼Œè¿˜ä¼šé¿å…ä¸ºä»»ä½•æŒä¹…å¯¹è±¡ï¼ˆå¦‚æ–‡ä»¶ï¼‰æ·»åŠ æ ‡ç­¾ï¼Œè¿™ä½¿å¾—åœ¨ä»¥åå¯ç”¨ SELinux éå¸¸å›°éš¾ã€‚</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://alleny.xyz/post-images/1713149237443.png" alt="" loading="lazy"></figure>
<h4 id="æ£€æŸ¥-selinux-çš„è¿è¡Œæ¨¡å¼">æ£€æŸ¥ SELinux çš„è¿è¡Œæ¨¡å¼</h4>
<p>ä½¿ç”¨ <code>getenforce</code> æˆ– <code>sestatus</code> å‘½ä»¤æ£€æŸ¥ SELinux çš„è¿è¡Œæ¨¡å¼ã€‚</p>
<p><code>getenforce</code> å‘½ä»¤è¿”å› <code>Enforcing</code>ã€<code>Permissive</code> æˆ– <code>Disabled</code>ã€‚</p>
<p><code>sestatus</code> å‘½ä»¤è¿”å› SELinux çŠ¶æ€ä»¥åŠæ­£åœ¨ä½¿ç”¨çš„ SELinux ç­–ç•¥ï¼š</p>
<pre><code>$ sestatus
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Memory protection checking:     actual (secure)
Max kernel policy version:      31
</code></pre>
<h4 id="æ›´æ”¹-selinux-çŠ¶æ€å’Œæ¨¡å¼">æ›´æ”¹ SELinux çŠ¶æ€å’Œæ¨¡å¼</h4>
<p>ä½¿ç”¨ <code>setenforce</code> å®ç”¨ç¨‹åºåœ¨ enforcing æ¨¡å¼å’Œ permissive æ¨¡å¼ä¹‹é—´åˆ‡æ¢ã€‚ä½¿ç”¨ <code>setenforce</code> æ‰€åšçš„æ›´æ”¹åœ¨é‡æ–°å¼•å¯¼åä¸ä¼šä¿ç•™ã€‚è¦æ›´æ”¹ä¸º enforcing æ¨¡å¼ï¼Œä»¥ Linux root ç”¨æˆ·èº«ä»½è¾“å…¥ <code>setenforce 1</code> å‘½ä»¤ã€‚è¦æ›´æ”¹ä¸º permissive æ¨¡å¼ï¼Œè¾“å…¥ <code>setenforce 0</code> å‘½ä»¤ã€‚</p>
<pre><code># setenforce 0
# getenforce
Permissive
</code></pre>
<pre><code># setenforce 1
# getenforce
Enforcing
</code></pre>
<p>ä¹Ÿå¯ä»¥é€šè¿‡æ›´æ”¹é…ç½®æ–‡ä»¶æ¥æ°¸ä¹…æ›´æ”¹ SELinux æ¨¡å¼ã€‚</p>
<pre><code># vi /etc/selinux/config
</code></pre>
<pre><code># This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - No SELinux policy is loaded.
SELINUX=permissive
# SELINUXTYPE= can take one of these two values:
#       targeted - Targeted processes are protected,
#       mls - Multi Level Security protection.
SELINUXTYPE=targeted
</code></pre>
<pre><code># reboot
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç³»ç»Ÿå·²ç»åœ¨å…³é—­ SELinux çš„çŠ¶æ€ä¸‹è¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼Œå†æ‰“å¼€ SELinux ä¹‹åçš„ç¬¬ä¸€æ¬¡é‡å¯é€Ÿåº¦å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚å› ä¸ºç³»ç»Ÿå¿…é¡»ä¸ºç£ç›˜ä¸­çš„æ–‡ä»¶åˆ›å»ºå®‰å…¨ä¸Šä¸‹æ–‡ã€‚</p>
<h3 id="å®‰å…¨ä¸Šä¸‹æ–‡">å®‰å…¨ä¸Šä¸‹æ–‡</h3>
<h4 id="æ ¼å¼">æ ¼å¼</h4>
<p>æ¯ä¸ªè¿›ç¨‹å’Œç³»ç»Ÿèµ„æºéƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å®‰å…¨æ€§æ ‡ç­¾,ç§°ä¸º <em>SELinux ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰</em>ã€‚SELinux ä¸Šä¸‹æ–‡æœ‰æ—¶è¢«ç§°ä¸º <em>SELinux æ ‡ç­¾</em>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæå–ç³»ç»Ÿçº§åˆ«ç»†èŠ‚å¹¶ä¸“æ³¨äºå®ä½“çš„å®‰å…¨å±æ€§çš„<strong>æ ‡è¯†ç¬¦</strong>ã€‚è¿™ä¸ä»…æä¾›äº†åœ¨ SELinux ç­–ç•¥ä¸­å¼•ç”¨å¯¹è±¡çš„ä¸€ä¸ªä¸€è‡´æ–¹æ³•ï¼Œè€Œä¸”æ¶ˆé™¤äº†åœ¨å…¶ä»–èº«ä»½è¯†åˆ«ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨çš„æ¨¡ç³Šæ€§ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªæ–‡ä»¶å¯ä»¥åœ¨ä½¿ç”¨ç»‘å®šæŒ‚è½½çš„ç³»ç»Ÿä¸­æœ‰å¤šä¸ªæœ‰æ•ˆçš„è·¯å¾„åç§°ã€‚</p>
<p><strong>SELinux ç­–ç•¥åœ¨ä¸€ç³»åˆ—è§„åˆ™ä¸­ä½¿ç”¨è¿™äº›ä¸Šä¸‹æ–‡</strong>ï¼Œå®ƒä»¬å®šä¹‰è¿›ç¨‹å¦‚ä½•ç›¸äº’äº¤äº’ä»¥åŠä¸å„ç§ç³»ç»Ÿèµ„æºè¿›è¡Œäº¤äº’ã€‚é»˜è®¤æƒ…å†µä¸‹,ç­–ç•¥ä¸å…è®¸ä»»ä½•äº¤äº’,é™¤éè§„åˆ™æ˜ç¡®æˆäºˆäº†ç›¸åº”çš„æƒé™ã€‚</p>
<p>Linux ç”¨æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ç”± SELinux ç”¨æˆ·ã€SELinux è§’è‰²å’Œ SELinux ç±»å‹ç»„æˆã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>User:Role:Type:Level
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://alleny.xyz/post-images/1713149279655.png" alt="" loading="lazy"></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸‰ä¸ªåŸŸå³ç±»å‹åŸŸåœ¨è¿›ç¨‹å’Œæ–‡ä»¶ä¸Šåˆæœ‰ä¸åŒçš„ç§°å‘¼</p>
<ul>
<li>typeï¼šåœ¨æ–‡ä»¶èµ„æºï¼ˆobjectï¼‰ä¸Šé¢ç§°ä¸ºç±»å‹ï¼ˆtypeï¼‰</li>
<li>domainï¼šåœ¨ä¸»ä½“è¿›ç¨‹ï¼ˆsubjectï¼‰åˆ™ç§°ä¸ºåŸŸï¼ˆdomainï¼‰</li>
</ul>
<h4 id="æŸ¥è¯¢å®‰å…¨ä¸Šä¸‹æ–‡">æŸ¥è¯¢å®‰å…¨ä¸Šä¸‹æ–‡</h4>
<pre><code># æŸ¥è¯¢è¿›ç¨‹çš„å®‰å…¨ä¸Šä¸‹æ–‡
[root@localhost ~]# ps -auxZ | egrep 'bash|chronyd|LABEL'
LABEL                                                 USER   ...  COMMAND
system_u:system_r:chronyd_t:s0                        chrony ...  /usr/sbin/chronyd -F 2
unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 root   ...  -bash

# æŸ¥è¯¢æ–‡ä»¶çš„å®‰å…¨ä¸Šä¸‹æ–‡
[root@localhost ~]# ll -Z /usr/sbin/chronyd /etc/chrony.keys
-rw-r-----. 1 root chrony system_u:object_r:chronyd_keys_t:s0    540 Aug 29  2022 /etc/chrony.keys
-rwxr-xr-x. 1 root root   system_u:object_r:chronyd_exec_t:s0 353408 Apr 17 07:40 /usr/sbin/chronyd

[root@localhost ~]# ll -Zd /root/anaconda-ks.cfg /home/vbird
drwx------. 2 vbird vbird unconfined_u:object_r:user_home_dir_t:s0  113 Aug  4 13:43 /home/vbird
-rw-------. 1 root  root  system_u:object_r:admin_home_t:s0        1204 Aug  4 13:05 /root/anaconda-ks.cfg
</code></pre>
<h4 id="å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¿®æ”¹">å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¿®æ”¹</h4>
<h5 id="æ‰‹åŠ¨ä¿®æ”¹">æ‰‹åŠ¨ä¿®æ”¹</h5>
<p>ä½¿ç”¨ <code>chcon</code> æ‰‹åŠ¨ä¿®æ”¹å®‰å…¨ä¸Šä¸‹æ–‡ç±»å‹ã€‚</p>
<pre><code>[root@localhost ~]# chcon [OPTION]... [-t TYPE] FILE...
[root@localhost ~]# chcon [OPTION]... --reference=RFILE FILE...
é€‰é¡¹ä¸å‚æ•°ï¼š
-t  ï¼šåé¢æ¥å®‰å…¨ä¸Šä¸‹æ–‡çš„ç±»å‹ï¼Œä¾‹å¦‚ httpd_sys_content_t
--reference=RFILEï¼šç”¨æ–‡ä»¶åä¸º RFILE å½“èŒƒä¾‹ä¾†ä¿®æ”¹åç»­æ¥çš„æ–‡ä»¶çš„ç±»å‹

# å°† /etc/hosts å¤åˆ¶åˆ° /dev/shm/hostsï¼Œå¹¶ä¿®æ”¹ç±»å‹ä¸º etc_t
[root@localhost ~]# cd /dev/shm
[root@localhost shm]# cp -a /etc/hosts .
[root@localhost shm]# ll -Z hosts
-rw-r--r--. 1 root root system_u:object_r:net_conf_t:s0 158 Jun 23  2020 hosts

[root@localhost shm]# chcon -t etc_t hosts
[root@localhost shm]# ll -Z hosts
-rw-r--r--. 1 root root system_u:object_r:etc_t:s0 158 Jun 23  2020 hosts

# å°†ç±»å‹æ”¹æˆä¸ /var/spool/mail ç›¸åŒ
[root@localhost shm]# ll -Zd /var/spool/mail/
drwxrwxr-x. 2 root mail system_u:object_r:mail_spool_t:s0 19 Jul 21 15:01 /var/spool/mail/

[root@localhost shm]# chcon --reference=/var/spool/mail hosts
[root@localhost shm]# ll -Z hosts
-rw-r--r--. 1 root root system_u:object_r:mail_spool_t:s0 158 Jun 23  2020 hosts
</code></pre>
<h5 id="ä½¿ç”¨ç›®å½•çš„é»˜è®¤å®‰å…¨ä¸Šä¸‹æ–‡æ¥ä¿®æ”¹">ä½¿ç”¨ç›®å½•çš„é»˜è®¤å®‰å…¨ä¸Šä¸‹æ–‡æ¥ä¿®æ”¹</h5>
<p>ç›®å½•æ˜¯æœ‰é»˜è®¤çš„å®‰å…¨ä¸Šä¸‹æ–‡çš„ã€‚å¯ä»¥ä½¿ç”¨ <code>semanage</code> æ¥æŸ¥è¯¢å’Œä¿®æ”¹ç›®å½•çš„é»˜è®¤å®‰å…¨ä¸Šä¸‹æ–‡ã€‚</p>
<pre><code class="language-bash">semanage {login|user|port|interface|fcontext|translation} -l
semanage fcontext -{a|d|m} [-frst] file_spec

é€‰é¡¹ä¸å‚æ•°ï¼š
        fcontextï¼šä¸»è¦ç”¨åœ¨å®‰å…¨ä¸Šä¸‹æ–‡æ–¹é¢çš„ç”¨é€”ï¼Œ -l ä¸ºæŸ¥è¯¢
        -aï¼šå¢åŠ ï¼›å¯ä»¥å¢åŠ ä¸€äº›ç›®å½•çš„é»˜è®¤å®‰å…¨ä¸Šä¸‹æ–‡ç±»å‹è®¾ç½®
        -mï¼šä¿®æ”¹
        -dï¼šåˆ é™¤
</code></pre>
<p>ä¾‹å¦‚æŸ¥è¯¢ <code>/etc/sysconfig</code> ç›¸å…³çš„é»˜è®¤ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ç±»å‹ï¼š</p>
<pre><code>[root@localhost ~]# semanage fcontext --list | grep /etc/sysconfig
SELinux fcontext              type           Context
/etc/sysconfig/.*l2tpd        regular file   system_u:object_r:l2tp_conf_t:s0
/etc/sysconfig/MailScanner    regular file   system_u:object_r:mscan_etc_t:s0
</code></pre>
<p>å‡è®¾æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªåä¸º <code>/www</code> çš„ç›®å½•ï¼Œæˆ‘ä»¬æƒ³è¦æŒ‡å®šå…¶å®‰å…¨ä¸Šä¸‹æ–‡é»˜è®¤å€¼ä¸ <code>/var/www</code> ç›®å½•ç›¸åŒï¼š</p>
<pre><code># 1. å…ˆæ‰¾åˆ° /var/www çš„ç±»å‹æ˜¯ä»€ä¹ˆ
[root@localhost ~]# semanage fcontext -l | grep '/var/www('
/var/www(/.*)?              all files   system_u:object_r:httpd_sys_content_t:s0
/var/www(/.*)?/logs(/.*)?   all files   system_u:object_r:httpd_log_t:s0

# 2. å»ºç«‹æ‰€éœ€ç›®å½•ï¼Œå¹¶ä¸”æŸ¥çœ‹å…¶é¢„è®¾çš„å®‰å…¨ä¸Šä¸‹æ–‡çš„å€¼
[root@localhost ~]# mkdir /www
[root@localhost ~]# echo check &gt; /www/index.html
[root@localhost ~]# ll -Zd /www /www/index.html
drwxr-xr-x. 2 root root unconfined_u:object_r:default_t:s0 24 Jul 22 14:40 /www
-rw-r--r--. 1 root root unconfined_u:object_r:default_t:s0  6 Jul 22 14:40 /www/index.html
# å€¼ä¸º default_t

# 3. å¢åŠ  /www é»˜è®¤ä¸º httpd_sys_content_t çš„ç±»å‹
[root@localhost ~]# semanage fcontext -a -t httpd_sys_content_t &quot;/www(/.*)?&quot;
[root@localhost ~]# semanage fcontext -l | grep '^/www'
/www(/.*)?    all files     system_u:object_r:httpd_sys_content_t:s0
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº† <code>/www</code> çš„é»˜è®¤ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>restorecon</code> ç›´æ¥æŠŠæ–‡ä»¶æˆ–ç›®å½•çš„å®‰å…¨ä¸Šä¸‹æ–‡æ¢å¤åˆ°é»˜è®¤å€¼ã€‚</p>
<pre><code>[root@localhost ~]# restorecon -Rv /www
Relabeled /www from unconfined_u:object_r:default_t:s0 
  to unconfined_u:object_r:httpd_sys_content_t:s0
Relabeled /www/index.html from unconfined_u:object_r:default_t:s0 
  to unconfined_u:object_r:httpd_sys_content_t:s0
</code></pre>
<h4 id="ç«¯å£å®‰å…¨ä¸Šä¸‹æ–‡æŸ¥è¯¢ä¸ä¿®æ”¹-ä½¿ç”¨-semanage-port">ç«¯å£å®‰å…¨ä¸Šä¸‹æ–‡æŸ¥è¯¢ä¸ä¿®æ”¹ -- ä½¿ç”¨ <code>semanage port</code></h4>
<p>ä¸€ä¸ªç«¯å£çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡é€šå¸¸åªåŒ…æ‹¬ç±»å‹ä¿¡æ¯ã€‚</p>
<p><code>semanage port -l</code> ç”¨äºæŸ¥çœ‹æ‰€æœ‰ç«¯å£çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-cpp">[root@localhost ~]# semanage port --list | grep http
http_cache_port_t  tcp  8080, 8118, 8123, 10001-10010
http_cache_port_t  udp  3130
http_port_t        tcp  80, 81, 443, 488, 8008, 8009, 8443, 9000
</code></pre>
<p>ä¹Ÿå¯ä»¥æ·»åŠ æŸç±»è¿›ç¨‹å…è®¸è®¿é—®çš„ç«¯å£ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>[root@localhost ~]# semanage port -a -t TYPE -p [tcp|udp] port_range
-a   æ–°å¢ä¸€ä¸ªè®°å½•
-t   ä¿®æ”¹çš„ç«¯å£ç±»å‹ï¼Œä¾‹å¦‚ httpd_port_t
-p   ä½¿ç”¨ tcp æˆ– udp åè®®
port_range ä½¿ç”¨çš„ç«¯å£å·

# åŠ å…¥ port 98 çš„ä½¿ç”¨åˆ° http ä¸­
[root@localhost ~]# semanage port -a -t http_port_t -p tcp 98
[root@localhost ~]# semanage port --list | grep http
http_port_t    tcp     98, 80, 81, 443, 488, 8008, 8009, 8443, 9000
</code></pre>
<h3 id="selinux-æ”¿ç­–å†…çš„è§„åˆ™ç®¡ç†"><strong>SELinux æ”¿ç­–å†…çš„è§„åˆ™ç®¡ç†</strong></h3>
<p><code>getsebool -a</code> å‘½ä»¤åˆ—å‡ºè§„åˆ™å¸ƒå°”å€¼ï¼ˆè§„åˆ™æ˜¯æ‰“å¼€è¿˜æ˜¯å…³é—­çŠ¶æ€ï¼‰ã€‚</p>
<pre><code>~]$ getsebool -a
cvs_read_shadow --&gt; off
daemons_dump_core --&gt; on
</code></pre>
<p><code>setsebool</code> ä¿®æ”¹ SELinux è§„åˆ™çš„å¸ƒå°”å€¼ã€‚</p>
<pre><code>setsebool [-p] [è§„åˆ™åç§°][0|1]

-Pï¼šç›´æ¥å°†è®¾ç½®å€¼å†™å…¥é…ç½®æ–‡ä»¶ï¼Œè¯¥è®¾ç½®æ•°æ®æœªæ¥ä¼šç”Ÿæ•ˆ
</code></pre>
<pre><code># èŒƒä¾‹ï¼šæŸ¥è¯¢ httpd_enable_homedirs è¿™ä¸ªè§„åˆ™çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¿®æ”¹è¿™ä¸ªè§„åˆ™ä¸ºä¸åŒçš„å¸ƒå°”å€¼
[root@study ~]# getsebool httpd_enable_homedirs
httpd_enable_homedirs --&gt; off                        # å…³é—­çŠ¶æ€
[root@study ~]# setsebool -P httpd_enable_homedirs 1                # å¼€å¯å®ƒ
[root@study ~]# getsebool httpd_enable_homedirs
httpd_enable_homedirs --&gt; on
</code></pre>
<p><code>seinfo</code> å¯ç”¨äºæè¿°ç­–ç•¥çš„ç»†åˆ†ï¼Œå¦‚ç±»ã€ç±»å‹ã€å¸ƒå°”å€¼ã€å…è®¸è§„åˆ™ç­‰ã€‚</p>
<pre><code class="language-sql">seinfo [-Atrub]

é€‰é¡¹ä¸å‚æ•°ï¼š
        -Aï¼šåˆ—å‡º SELinux çš„çŠ¶æ€ã€è§„åˆ™å¸ƒå°”å€¼ã€èº«ä»½è¯†åˆ«ã€è§’è‰²ã€ç±»å‹ç­‰æ‰€æœ‰ä¿¡æ¯
        -uï¼šåˆ—å‡º SELinux çš„æ‰€æœ‰èº«ä»½è¯†åˆ« user ç§ç±»
        -rï¼šåˆ—å‡º SELinux çš„æ‰€æœ‰è§’è‰² role ç§ç±»
        -tï¼šåˆ—å‡º SELinux çš„æ‰€æœ‰ç±»å‹ type ç§ç±»
        -bï¼šåˆ—å‡ºæ‰€æœ‰è§„åˆ™çš„ç§ç±»ï¼ˆå¸ƒå°”å€¼ï¼‰
</code></pre>
<pre><code class="language-sql">~]# seinfo

Statistics for policy file: /sys/fs/selinux/policy
Policy Version &amp; Type: v.28 (binary, mls)

   Classes:            77    Permissions:       229
   Sensitivities:       1    Categories:       1024
   Types:            3001    Attributes:        244
   Users:               9    Roles:              13
   Booleans:          158    Cond. Expr.:       193
   Allow:          262796    Neverallow:          0
   Auditallow:         44    Dontaudit:      156710
   Type_trans:      10760    Type_change:        38
   Type_member:        44    Role allow:         20
   Role_trans:        237    Range_trans:      2546
   Constraints:        62    Validatetrans:       0
   Initial SIDs:       27    Fs_use:             22
   Genfscon:           82    Portcon:           373
   Netifcon:            0    Nodecon:             0
   Permissives:        22    Polcap:              2
</code></pre>
<p><code>sesearch</code> æœç´¢ç­–ç•¥ä¸­çš„ç‰¹å®šè§„åˆ™ã€‚</p>
<pre><code class="language-sql">sesearch [-A] [-s ä¸»ä½“ç±»åˆ«] [-t ç›®æ ‡ç±»åˆ«] [-b å¸ƒå°”å€¼]

é€‰é¡¹ä¸å‚æ•°ï¼š
        -Aï¼šåˆ—å‡ºåé¢æ•°æ®ä¸­ï¼Œå…è®¸ã€Œè¯»å–æˆ–æ”¾è¡Œã€çš„ç›¸å…³æ•°æ®
        -tï¼šåé¢è¿˜è¦æ¥ typeã€ä¾‹å¦‚ -t httpd_t
        -bï¼šåé¢æ¥ SELinux çš„è§„åˆ™ï¼Œä¾‹å¦‚ -b httpd_enable_ftp_server
</code></pre>
<pre><code># èŒƒä¾‹ï¼šæ‰¾å‡º crond_t ä¸»ä½“è¿›ç¨‹èƒ½å¤Ÿè¯»å–çš„æ–‡ä»¶ SELinux type
[root@study ~]# sesearch -A -s crond_t | grep spool
   allow crond_t var_spool_t : dir { ioctl read getattr lock search open } ; 
   allow crond_t system_cron_spool_t : dir { ioctl read getattr lock search open } ; 
   allow crond_t user_cron_spool_t : lnk_file { read getattr } ; 
   allow crond_t user_cron_spool_t : file { ioctl read write create getattr setattr lock append unlink link rename open } ; 
   allow crond_t system_cron_spool_t : file { ioctl read write create getattr setattr lock append unlink link rename open } ; 
   allow crond_t var_spool_t : file { ioctl read getattr lock open } ; 
   allow crond_t cron_spool_t : file { ioctl read write create getattr setattr lock append unlink link rename open } ; 
   allow daemon user_cron_spool_t : file { ioctl read write getattr lock append } ; 
   allow crond_t cron_spool_t : dir { ioctl read write getattr lock add_name remove_name search open } ; 
   allow crond_t user_cron_spool_t : dir { ioctl read write getattr lock add_name remove_name search open } ; 
   allow crond_t user_cron_spool_t : file { ioctl read write create getattr setattr lock append unlink link rename open } ; 
   allow crond_t system_cron_spool_t : file { ioctl read write create getattr setattr lock append unlink link rename open } ;
</code></pre>
<h3 id="æ¡ˆä¾‹å½“-port-å‡ºé—®é¢˜æ—¶è®©-httpd-å¼€æ”¾åœ¨éæ­£è§„ç«¯å£">æ¡ˆä¾‹ï¼šå½“ port å‡ºé—®é¢˜æ—¶ï¼šè®© httpd å¼€æ”¾åœ¨éæ­£è§„ç«¯å£</h3>
<p>å¦‚æœ <code>auditd</code> å®ˆæŠ¤è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œåˆ™ SELinux æ‹’ç»ä¿¡æ¯ä¼šé»˜è®¤å†™å…¥ <code>/var/log/audit/audit.log</code> ï¼š</p>
<pre><code>type=AVC msg=audit(1223024155.684:49): avc:  denied  { getattr } for  pid=2000 comm=&quot;httpd&quot; path=&quot;/var/www/html/file1&quot; dev=dm-0 ino=399185 scontext=unconfined_u:system_r:httpd_t:s0 tcontext=system_u:object_r:samba_share_t:s0 tclass=file
</code></pre>
<p>å¦å¤–ï¼Œç±»ä¼¼ä»¥ä¸‹çš„æ¶ˆæ¯è¢«å†™å…¥ <code>/var/log/message</code> æ–‡ä»¶ä¸­ï¼š</p>
<pre><code>May 7 18:55:56 localhost setroubleshoot: SELinux is preventing httpd (httpd_t) &quot;getattr&quot; to /var/www/html/file1 (samba_share_t). For complete SELinux messages. run sealert -l de7e30d6-5488-466d-a606-92c9f40d316d
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªåœºæ™¯ï¼Œè®© <code>httpd</code> ä½¿ç”¨éæ­£è§„çš„ 377 ç«¯å£ï¼š</p>
<pre><code># 1. ä¿®æ”¹ç«¯å£å·ç 
[root@localhost ~]# vim /etc/httpd/conf/httpd.conf
Listen 377

# 2. å°è¯•å¯åŠ¨ httpd æœåŠ¡
[root@localhost ~]# systemctl start httpd
Job for httpd.service failed because the control process exited with error code.
See &quot;systemctl status httpd.service&quot; and &quot;journalctl -xeu httpd.service&quot; for details.
_# å¦‚ä¸Šæ‰€ç¤ºï¼Œæç¤ºå‡ºç°é”™è¯¯_

# 3. ç¡®è®¤ /var/log/messages æ˜¯å¦è®°å½•é”™è¯¯è§£å†³æ–¹æ¡ˆ
[root@localhost ~]# grep setrouble /var/log/messages | grep sealert
Aug  4 22:13:38 localhost setroubleshoot[3553]: SELinux is preventing /usr/sbin/httpd
  from name_bind access on the tcp_socket port 377. For complete SELinux messages
  run: sealert -l 525fe157-a16b-47c4-ad8d-11bad86c9e9a
# æ‰¾åˆ° sealert å…³é”®å­—

# 4. è¿è¡Œæ‰¾åˆ°çš„ sealert æŒ‡ä»¤ï¼Œå¹¶ä¾æ®æç¤ºå¤„ç†é—®é¢˜
[root@localhost ~]# sealert -l 525fe157-a16b-47c4-ad8d-11bad86c9e9a
SELinux is preventing /usr/sbin/httpd from name_bind access on the tcp_socket port 377.

*****  Plugin bind_ports (99.5 confidence) suggests   ************************

If you want to allow /usr/sbin/httpd to bind to network port 377
Then you need to modify the port type.
Do
# semanage port -a -t PORT_TYPE -p tcp 377
    where PORT_TYPE is one of the following: http_cache_port_t, http_port_t, ...

***  Plugin catchall (1.49 confidence) suggests   **************************
....
</code></pre>
<p><code>sealert</code> æ˜¯ <code>setroubleshoot</code> åŒ…æä¾›çš„å·¥å…·ã€‚<code>sealert</code> å¯èƒ½ä¼šæä¾›å¥½å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼Œé€‰æ‹©ç½®ä¿¡åº¦æœ€é«˜çš„å³å¯ã€‚</p>
<pre><code>[root@localhost ~]# semanage port -a -t http_port_t -p tcp 377
[root@localhost ~]# systemctl restart httpd
</code></pre>
<h2 id="åŸç†">åŸç†</h2>
<h3 id="lsm">LSM</h3>
<h4 id="overview">Overview</h4>
<p>Linux å®‰å…¨æ¨¡å—ï¼ˆè‹±è¯­ï¼šLinux Security Modulesï¼Œç®€ç§° LSMï¼‰æ˜¯ Linux å†…æ ¸ä¸­ç”¨äºæ”¯æŒå„ç§è®¡ç®—æœºå®‰å…¨æ¨¡å‹çš„æ¡†æ¶ï¼Œå®ƒä¸ä»»ä½•å•ç‹¬çš„å®‰å…¨å®ç°æ— å…³ã€‚è¿™ä¸ªæ¡†æ¶ä½¿ç”¨ GNU é€šç”¨å…¬å…±è®¸å¯è¯æˆæƒï¼Œå¹¶ä¸”ä» Linux 2.6 å¼€å§‹æˆä¸ºå®˜æ–¹ Linux å†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚ç›®å‰ï¼ŒAppArmorã€SELinuxã€Smackã€TOMOYO Linux å’Œ Yama æ˜¯å®˜æ–¹ Linux å†…æ ¸ä¸­æ”¯æŒçš„å®‰å…¨æ¨¡å—ã€‚</p>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼ŒLSM æ˜¯ç›®å‰ linux çš„å®‰å…¨æ¡†æ¶ï¼Œè€Œ SELinux æ˜¯å…¶ä¸­çš„ä¸€ä¸ª modulesã€‚</p>
</blockquote>
<p>LSM åœ¨ linux å®‰å…¨ä½“ç³»ä¸­æ‰€å¤„ä½ç½®å¯ä»¥ç”¨ä¸‹å›¾è¡¨è¿°ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://alleny.xyz/post-images/1713149321948.png" alt="" loading="lazy"></figure>
<p>LSM åœ¨å†…æ ¸ç³»ç»Ÿè°ƒç”¨é€»è¾‘ä¸­æä¾›äº†ä¸€å¥—é’©å­ï¼ˆhooksï¼‰ã€‚LSM hook ä¼šæ’å…¥åˆ°è®¿é—® kernel å¯¹è±¡å‰é¢ï¼ŒDAC æ£€æŸ¥ä¹‹åï¼Œç„¶å LSM è°ƒç”¨ç³»ç»Ÿä¸­å¯ç”¨çš„è®¿é—®æ§åˆ¶æ¨¡å—ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®ã€‚è‹¥æœ‰å¤šä¸ªè®¿é—®æ§åˆ¶æ¨¡å—ï¼Œä¼šæ ¹æ®åˆå§‹åŒ–çš„ä¼˜å…ˆé¡ºåºæ‰§è¡Œï¼Œéƒ½å…è®¸è®¿é—®æ‰èƒ½è¿›ä¸€æ­¥è®¿é—® kernel å¯¹è±¡ã€‚</p>
<h4 id="lsm-ä¸­çš„æ¥å£ç®¡ç†"><strong>LSM ä¸­çš„æ¥å£ç®¡ç†</strong></h4>
<p>LSM ä¸­ä½¿ç”¨ <code>security_hook_heads</code> å°†å„è®¿é—®æ§åˆ¶æ¨¡å—çš„æ¥å£ç®¡ç†èµ·æ¥ã€‚</p>
<pre><code>struct security_hook_heads {
        #define LSM_HOOK(RET, DEFAULT, NAME, ...) struct hlist_head NAME; // æ­¤å¤„å®šä¹‰ LSM_HOOK ä¸ºåªå–æ¥å£åå­—
        #include &quot;lsm_hook_defs.h&quot; // åŒ…å«æ¥å£æ–‡ä»¶
        #undef LSM_HOOK
} __randomize_layout;
</code></pre>
<p>æ¥å£æ–‡ä»¶ <code>lsm_hook_defs.h</code> ä¸­çš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-cpp">... ...
LSM_HOOK(int, 0, file_permission, struct file *file, int mask)
LSM_HOOK(int, 0, file_alloc_security, struct file *file)
LSM_HOOK(int, 0, file_ioctl, struct file *file, unsigned int cmd, unsigned long arg)
LSM_HOOK(int, 0, file_mprotect, struct vm_area_struct *vma, unsigned long reqprot, unsigned long prot)
LSM_HOOK(int, 0, file_lock, struct file *file, unsigned int cmd)
LSM_HOOK(int, 0, file_fcntl, struct file *file, unsigned int cmd, unsigned long arg)
LSM_HOOK(int, 0, file_receive, struct file *file)
LSM_HOOK(int, 0, file_open, struct file *file)
... ...
</code></pre>
<p>å› æ­¤å®é™… <code>security_hook_heads</code> æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-cpp">struct security_hook_heads {
        ... ...
    struct hlist_head file_permission;
    struct hlist_head file_alloc_security;
    struct hlist_head file_ioctl;
    struct hlist_head file_mprotect;
    struct hlist_head file_lock;
    struct hlist_head file_fcntl;
    struct hlist_head file_receive;
    struct hlist_head file_open;
    ... ...
} __randomize_layout;
</code></pre>
<p>æ¯ä¸ªè®¿é—®æ§åˆ¶æ¨¡å—éœ€è¦å®šä¹‰ <code>security_hook_list</code> æ•°ç»„ï¼Œ<code>security_hook_list</code> è®°å½•å•ä¸ªæ¥å£çš„ä¿¡æ¯ï¼Œç„¶åæ¨¡å—åˆå§‹åŒ–å‡½æ•°ä¸­ä¼šè°ƒç”¨ <code>security_add_hooks</code> å°† <code>security_hook_list</code> æ•°ç»„é“¾æ¥åˆ°ä¸Šé¢çš„ <code>security_hook_heads</code> ä¸Šã€‚</p>
<pre><code>struct security_hook_list {
        struct hlist_node                list; // ä¼šå°†è¯¥ hlist_node é“¾æ¥åˆ° security_hook_heads.æ¥å£ ä¸Š
        struct hlist_head                *head; // æŒ‡å‘ security_hook_heads.æ¥å£
        union security_list_options        hook; // æ¥å£å‡½æ•°å®ç°
        char                                *lsm; // è¯¥æ¨¡å—åå­—
} __randomize_layout;
</code></pre>
<p><code>security_hook_list</code> æ˜¯é€šè¿‡ LSM_HOOK_INIT å®èµ‹å€¼çš„ï¼Œè°ƒç”¨æ–¹æ³•ä¸º <code>LSM_HOOK_INIT(æ¥å£, æ¥å£å®ç°)</code>ï¼Œä¼šèµ‹å€¼ <code>head</code> å’Œ <code>hook</code> æˆå‘˜å˜é‡ã€‚</p>
<pre><code class="language-cpp">#define LSM_HOOK_INIT(HEAD, HOOK) \
        { .head = &amp;security_hook_heads.HEAD, .hook = { .HEAD = HOOK } }
</code></pre>
<p><code>security_add_hooks</code> å°†æ¯ä¸ªæ¥å£çš„ <code>security_hook_list.list</code> å®é™…æ·»åŠ åˆ° <code>security_hook_heads.æ¥å£</code> çš„æœ«å°¾ã€‚</p>
<pre><code class="language-cpp">void __init security_add_hooks(struct security_hook_list *hooks, int count,
                                char *lsm)
{
        int i;

        for (i = 0; i &lt; count; i++) {
                hooks[i].lsm = lsm;
                hlist_add_tail_rcu(&amp;hooks[i].list, hooks[i].head);
        }

... ...
}
</code></pre>
<h4 id="ä»-lsm-åˆ°-selinux">ä» LSM åˆ° SELinux</h4>
<p>å½“æˆ‘ä»¬æƒ³è¦è°ƒç”¨ <code>open</code> æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ç®€åŒ–ç‰ˆçš„è°ƒç”¨è·¯å¾„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>open
-------
    sys_open
        do_filp_open
            path_openat
                do_open
                    vfs_open
                        do_dentry_open
                            security_file_open
    error = security_file_open(f);
    if (error)
        goto cleanup_all;
</code></pre>
<p>å…¶ä¸­ <code>security_file_open</code> å°±æ˜¯ open ç³»ç»Ÿè°ƒç”¨çš„ä¸€ä¸ª LSM Hook ç‚¹ï¼Œå½“æ‰§è¡Œåˆ°æ­¤å¤„çš„æ—¶å€™ï¼Œå®ƒä¼šæ‰§è¡Œæ‰€æœ‰æŒ‚åœ¨æ­¤ hook ç‚¹ä¸Šçš„å®‰å…¨æ£€æŸ¥å‡½æ•°ã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://alleny.xyz/post-images/1713149344001.png" alt="" loading="lazy"></figure>
<p>ä»¥ SELinux ä¸ºä¾‹ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° <code>selinux_file_open</code> å‡½æ•°ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://alleny.xyz/post-images/1713149360497.png" alt="" loading="lazy"></figure>
<h3 id="selinux-å†…éƒ¨ç»“æ„">SELinux å†…éƒ¨ç»“æ„</h3>
<p>åœ¨çœ‹ <code>selinux_file_open</code> çš„ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ SELinux çš„å†…éƒ¨ç»“æ„ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://alleny.xyz/post-images/1713149373507.png" alt="" loading="lazy"></figure>
<p>æ ¹æ®ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚</p>
<ol>
<li>æ“ä½œç³»ç»Ÿä¸»ä½“å°è¯•è®¿é—®ç‰¹å®šå¯¹è±¡ï¼ˆæ–‡ä»¶ã€å¥—æ¥å­—ï¼‰ä¸Šçš„æŸä¸ªæ“ä½œï¼Œè¿™åœ¨ Linux æ ‡å‡†è‡ªä¸»å®‰å…¨ç³»ç»Ÿï¼ˆDACï¼‰ä¸­æ˜¯å…è®¸çš„ã€‚è¿™å°†å‘å¯¹è±¡å‘èµ·ä¸€ä¸ªè¯·æ±‚æµã€‚</li>
<li>æ¯ä¸ªè¦æ±‚å¯¹å¯¹è±¡æ‰§è¡Œæ“ä½œçš„è¯·æ±‚éƒ½ç”± Linux Security Modules æˆªè·å¹¶ä¼ é€’ç»™ SELinux Abstraction &amp; Hook Logic å­ç³»ç»Ÿï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬ä¸»ä½“å’Œå¯¹è±¡çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼ŒSELinux Abstraction &amp; Hook Logic å­ç³»ç»Ÿè´Ÿè´£ä¸ LSM äº¤äº’ã€‚</li>
<li>ä» SELinux Abstraction and Hook Logic å­ç³»ç»Ÿæ¥æ”¶åˆ°çš„ä¿¡æ¯å°†è½¬å‘ç»™åŸºæœ¬çš„ Policy Enforcement Server æ¨¡å—ï¼Œåè€…è´Ÿè´£ç¡®å®šæ˜¯å¦å…è®¸ä¸»ä½“è®¿é—®è¯¥å¯¹è±¡ã€‚</li>
<li>è¦æ¥æ”¶æ˜¯å¦å…è®¸æˆ–ç¦æ­¢è¯¥æ“ä½œçš„å†³å®šï¼Œç­–ç•¥å®æ–½æœåŠ¡å™¨å°†ä¸ Access Vector Cache å­ç³»ç»Ÿé€šä¿¡ï¼Œåè€…é€šå¸¸ä¼šç¼“å­˜è¦ä½¿ç”¨çš„è§„åˆ™ã€‚</li>
<li>å¦‚æœ AVC æ²¡æœ‰åŒ…å«ç›¸å…³ç­–ç•¥çš„ç¼“å­˜è§„åˆ™ï¼Œå¯¹æ‰€éœ€çš„å®‰å…¨ç­–ç•¥çš„è¯·æ±‚å°†å†æ¬¡è½¬å‘ç»™å®‰å…¨ç­–ç•¥æ•°æ®åº“ã€‚</li>
<li>åœ¨æ‰¾åˆ°å®‰å…¨ç­–ç•¥åï¼Œè¯¥ç­–ç•¥å°†è¢«ä¼ é€’ç»™æ¥æ”¶å†³ç­–çš„ç­–ç•¥æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æœæ‰€è¯·æ±‚çš„æ“ä½œç¬¦åˆæ‰¾åˆ°çš„ç­–ç•¥ï¼Œé‚£ä¹ˆå°†å…è®¸æ‰§è¡Œè¯¥æ“ä½œã€‚åä¹‹ï¼Œå°†ç¦æ­¢æ‰§è¡Œè¯¥æ“ä½œï¼Œå¹¶ä¸”æ‰€æœ‰å†³ç­–åˆ¶å®šä¿¡æ¯å°†è¢«å†™å…¥åˆ° SELinux æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</li>
</ol>
<p>é™¤äº†åˆ¤æ–­æ˜¯å¦å…è®¸æˆ–ç¦æ­¢æŸäº›æ“ä½œå¤–ï¼ŒPolicy Enforcement Server æ¨¡å—è¿˜è´Ÿè´£æ‰§è¡Œä¸€äº›è¾…åŠ©ä»»åŠ¡ï¼Œä¾‹å¦‚å®‰å…¨æ ‡ç­¾ç®¡ç†ï¼ˆåˆ†é…å’Œç§»é™¤ï¼‰ã€‚</p>
<blockquote>
<p>ä¸€å¥è¯æ€»ç»“ï¼šè¯·æ±‚æ¥äº†å» AVCï¼ˆä»¥åŠåé¢çš„ databaseï¼‰æŸ¥ä¸€ä¸‹ï¼Œæ¯”å¯¹æ˜¯å¦æœ‰æƒé™å³å¯ã€‚</p>
</blockquote>
<figure data-type="image" tabindex="8"><img src="https://alleny.xyz/post-images/1713149392656.png" alt="" loading="lazy"></figure>
<p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹ <code>selinux_file_open</code> çš„ä»£ç ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå» AVC æŸ¥æ‰¾ï¼Œç„¶åæ¯”å¯¹æƒé™ï¼Œè¿”å›ç»“æœçš„è¿‡ç¨‹ã€‚</p>
<pre><code class="language-cpp">static int selinux_file_open(struct file *file)
{
        struct file_security_struct *fsec;
        struct inode_security_struct *isec;

        fsec = selinux_file(file);
        isec = inode_security(file_inode(file));
        /*
         * Save inode label and policy sequence number
         * at open-time so that selinux_file_permission
         * can determine whether revalidation is necessary.
         * Task label is already saved in the file security
         * struct as its SID.
         */
        fsec-&gt;isid = isec-&gt;sid;
        fsec-&gt;pseqno = avc_policy_seqno();
        /*
         * Since the inode label or policy seqno may have changed
         * between the selinux_inode_permission check and the saving
         * of state above, recheck that access is still permitted.
         * Otherwise, access might never be revalidated against the
         * new inode label or new policy.
         * This check is not redundant - do not remove.
         */
        return file_path_has_perm(file-&gt;f_cred, file, open_file_to_av(file));
}
</code></pre>
<p><code>selinux_file_open</code> ä¼šè°ƒç”¨åˆ° <code>file_path_has_perm</code></p>
<pre><code class="language-cpp">/* Same as path_has_perm, but uses the inode from the file struct. */
static inline int file_path_has_perm(const struct cred *cred,
                                     struct file *file,
                                     u32 av)
{
        struct common_audit_data ad;

        ad.type = LSM_AUDIT_DATA_FILE;
        ad.u.file = file;
        return inode_has_perm(cred, file_inode(file), av, &amp;ad);
}
</code></pre>
<p>å†è°ƒç”¨åˆ° <code>inode_has_perm</code></p>
<pre><code class="language-cpp">/* Check whether a task has a particular permission to an inode.
   The 'adp' parameter is optional and allows other audit
   data to be passed (e.g. the dentry). */
static int inode_has_perm(const struct cred *cred,
                          struct inode *inode,
                          u32 perms,
                          struct common_audit_data *adp)
{
        struct inode_security_struct *isec;
        u32 sid;

        if (unlikely(IS_PRIVATE(inode)))
                return 0;

        sid = cred_sid(cred);
        isec = selinux_inode(inode);

        return avc_has_perm(sid, isec-&gt;sid, isec-&gt;sclass, perms, adp);
}
</code></pre>
<p>å†è°ƒç”¨åˆ° <code>avc_has_perm</code></p>
<pre><code class="language-cpp">int avc_has_perm(u32 ssid, u32 tsid, u16 tclass,
                 u32 requested, struct common_audit_data *auditdata)
{
        struct av_decision avd;
        int rc, rc2;

        rc = avc_has_perm_noaudit(ssid, tsid, tclass, requested, 0,
                                  &amp;avd);

        rc2 = avc_audit(ssid, tsid, tclass, requested, &amp;avd, rc,
                        auditdata);
        if (rc2)
                return rc2;
        return rc;
}
</code></pre>
<p>å†åˆ° <code>avc_has_perm_noaudit</code></p>
<pre><code class="language-cpp">inline int avc_has_perm_noaudit(u32 ssid, u32 tsid,
                                u16 tclass, u32 requested,
                                unsigned int flags,
                                struct av_decision *avd)
{
        u32 denied;
        struct avc_node *node;

        if (WARN_ON(!requested))
                return -EACCES;

        rcu_read_lock();
        node = avc_lookup(ssid, tsid, tclass);
        if (unlikely(!node)) {
                rcu_read_unlock();
                return avc_perm_nonode(ssid, tsid, tclass, requested,
                                       flags, avd);
        }
        denied = requested &amp; ~node-&gt;ae.avd.allowed;
        memcpy(avd, &amp;node-&gt;ae.avd, sizeof(*avd));
        rcu_read_unlock();

        if (unlikely(denied))
                return avc_denied(ssid, tsid, tclass, requested, 0, 0,
                                  flags, avd);
        return 0;
}
</code></pre>
<p>å¦‚æœ AVC æ²¡æŸ¥æ‰¾åˆ°ï¼Œè¿˜ä¼šè°ƒç”¨åˆ° <code>avc_perm_nonode</code></p>
<pre><code class="language-cpp">static noinline int avc_perm_nonode(u32 ssid, u32 tsid, u16 tclass,
                                    u32 requested, unsigned int flags,
                                    struct av_decision *avd)
{
        u32 denied;
        struct avc_xperms_node xp_node;

        avc_compute_av(ssid, tsid, tclass, avd, &amp;xp_node);
        denied = requested &amp; ~(avd-&gt;allowed);
        if (unlikely(denied))
                return avc_denied(ssid, tsid, tclass, requested, 0, 0,
                                  flags, avd);
        return 0;
}
</code></pre>
<p>æ³¨æ„ä¸Šé¢ä¸¤ä¸ªå‡½æ•°ä¸­çš„ <code>denied = requested &amp; ~node-&gt;ae.avd.allowed;</code> å’Œ <code>denied = requested &amp; ~(avd-&gt;allowed);</code> å°±æ˜¯åœ¨æ£€æŸ¥æƒé™äº†ã€‚å¦‚æœæƒé™ä¸æ»¡è¶³ï¼Œå°±ä¼šè¿”å› <code>avc_denied(ssid, tsid, tclass, requested, 0, 0, flags, avd)</code>ã€‚</p>
<p>æœ€åæ”¾ä¸€å¼ æ›´å…¨é¢çš„å›¾ï¼Œä¸Šé¢æ˜¯ç”¨æˆ·æ€ï¼Œä¸‹é¢æ˜¯å†…æ ¸æ€ã€‚</p>
<figure data-type="image" tabindex="9"><img src="https://alleny.xyz/post-images/1713149411256.png" alt="" loading="lazy"></figure>
<h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2>
<ul>
<li><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html/using_selinux/index">ä½¿ç”¨ SELinux - Red Hat</a></li>
<li><a href="https://wizardforcel.gitbooks.io/vbird-linux-basic-4e/content/143.html">SELinux åˆæ¢</a></li>
<li><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html-single/selinux_users_and_administrators_guide/index">SELinux ç”¨æˆ·å’Œç®¡ç†å‘˜æŒ‡å— -  Red Hat</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/352103792">Linux Security Modules æ¡†æ¶æºç åˆ†æ - çŸ¥ä¹</a></li>
<li><a href="https://saucer-man.com/operation_and_maintenance/84.html#cl-13">SELinux çš„å·¥ä½œæ¨¡å¼å’Œæ¶æ„</a></li>
<li><a href="https://liwugang.github.io/2020/10/18/introduce_lsm.html">Linux Security Module æ¡†æ¶ä»‹ç»</a></li>
<li><a href="https://github.com/torvalds/linux/blob/20cb38a7af88dc40095da7c2c9094da3873fea23/security/selinux/hooks.c#L3962"><code>selinux_file_open</code>æºç </a></li>
</ul>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E8%83%BD%E5%8A%9B">èƒ½åŠ›</a>
<ul>
<li><a href="#selinux-%E6%98%AF%E4%BB%80%E4%B9%88">SELinux æ˜¯ä»€ä¹ˆ</a>
<ul>
<li><a href="#dacdiscretionary-access-control%E8%87%AA%E4%B8%BB%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6">DACï¼ˆDiscretionary Access Controlï¼Œè‡ªä¸»è®¿é—®æ§åˆ¶ï¼‰</a></li>
<li><a href="#macmandatory-access-control%E5%BC%BA%E5%88%B6%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6">MACï¼ˆMandatory Access Controlï¼Œå¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼‰</a></li>
</ul>
</li>
<li><a href="#%E4%BD%BF%E7%94%A8-selinux-%E7%9A%84%E5%A5%BD%E5%A4%84">ä½¿ç”¨ SELinux çš„å¥½å¤„</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A5%E5%8F%A3%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">æ¥å£å’Œä½¿ç”¨æ–¹æ³•</a>
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#selinux-%E7%8A%B6%E6%80%81%E5%92%8C%E6%A8%A1%E5%BC%8F">SELinux çŠ¶æ€å’Œæ¨¡å¼</a>
<ul>
<li><a href="#%E6%A3%80%E6%9F%A5-selinux-%E7%9A%84%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F">æ£€æŸ¥ SELinux çš„è¿è¡Œæ¨¡å¼</a></li>
<li><a href="#%E6%9B%B4%E6%94%B9-selinux-%E7%8A%B6%E6%80%81%E5%92%8C%E6%A8%A1%E5%BC%8F">æ›´æ”¹ SELinux çŠ¶æ€å’Œæ¨¡å¼</a></li>
</ul>
</li>
<li><a href="#%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87">å®‰å…¨ä¸Šä¸‹æ–‡</a>
<ul>
<li><a href="#%E6%A0%BC%E5%BC%8F">æ ¼å¼</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87">æŸ¥è¯¢å®‰å…¨ä¸Šä¸‹æ–‡</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E4%BF%AE%E6%94%B9">å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¿®æ”¹</a>
<ul>
<li><a href="#%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9">æ‰‹åŠ¨ä¿®æ”¹</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%9B%AE%E5%BD%95%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E6%9D%A5%E4%BF%AE%E6%94%B9">ä½¿ç”¨ç›®å½•çš„é»˜è®¤å®‰å…¨ä¸Šä¸‹æ–‡æ¥ä¿®æ”¹</a></li>
</ul>
</li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E6%9F%A5%E8%AF%A2%E4%B8%8E%E4%BF%AE%E6%94%B9-%E4%BD%BF%E7%94%A8-semanage-port">ç«¯å£å®‰å…¨ä¸Šä¸‹æ–‡æŸ¥è¯¢ä¸ä¿®æ”¹ -- ä½¿ç”¨ <code>semanage port</code></a></li>
</ul>
</li>
<li><a href="#selinux-%E6%94%BF%E7%AD%96%E5%86%85%E7%9A%84%E8%A7%84%E5%88%99%E7%AE%A1%E7%90%86"><strong>SELinux æ”¿ç­–å†…çš„è§„åˆ™ç®¡ç†</strong></a></li>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%BD%93-port-%E5%87%BA%E9%97%AE%E9%A2%98%E6%97%B6%E8%AE%A9-httpd-%E5%BC%80%E6%94%BE%E5%9C%A8%E9%9D%9E%E6%AD%A3%E8%A7%84%E7%AB%AF%E5%8F%A3">æ¡ˆä¾‹ï¼šå½“ port å‡ºé—®é¢˜æ—¶ï¼šè®© httpd å¼€æ”¾åœ¨éæ­£è§„ç«¯å£</a></li>
</ul>
</li>
<li><a href="#%E5%8E%9F%E7%90%86">åŸç†</a>
<ul>
<li><a href="#lsm">LSM</a>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#lsm-%E4%B8%AD%E7%9A%84%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86"><strong>LSM ä¸­çš„æ¥å£ç®¡ç†</strong></a></li>
<li><a href="#%E4%BB%8E-lsm-%E5%88%B0-selinux">ä» LSM åˆ° SELinux</a></li>
</ul>
</li>
<li><a href="#selinux-%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84">SELinux å†…éƒ¨ç»“æ„</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">å‚è€ƒæ–‡çŒ®</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://alleny.xyz/post/leetcode-linked-list/">
              <h3 class="post-title">
                LeetCodeåˆ·é¢˜è®°å½•ï¼ˆé“¾è¡¨ç¯‡ï¼‰
              </h3>
            </a>
          </div>
        

        
          

          
            <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css">
<script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>

<div id="disqus_thread"></div>

<script>

var options = {
  shortname: 'alleny-blog',
  apikey: '2kPJh2tQ0rWB7n0QOhvb9TLbm946tHMWCixW2qGF9j8tfMBgZoNPfvLpDoxZTZpD',
}
if ('https://disqus.hangyu-yuan.workers.dev/api/') {
  options.api = 'https://disqus.hangyu-yuan.workers.dev/api/'
}
var dsqjs = new DisqusJS(options)

</script>

          
        

        <div class="site-footer">
  Copyright Â© 2023-2025 Allen Yuan. All rights reserved.
  <a class="rss" href="https://alleny.xyz/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
